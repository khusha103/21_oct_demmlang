<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Chat</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" #content>
  <!-- Empty State -->
  <div *ngIf="messages.length === 0" class="empty-state">
    <ion-icon name="chatbubbles-outline"></ion-icon>
    <p>Start a conversation</p>
    <small>Type a message below to begin</small>
  </div>

  <!-- Messages -->
  <div *ngFor="let message of messages; let i = index" 
       class="message-wrapper" 
       [class.user]="message.from === 'user'"
       [@slideIn]>
    <div class="message">
      <p>{{ message.showingEnglish ? message.englishText : message.text }}</p>
      
      <div class="message-footer">
        <span class="timestamp">{{ message.timestamp | date:'short' }}</span>
        
        <!-- Toggle button for translated messages -->
        <ion-button 
          *ngIf="message.wasTranslated" 
          fill="clear" 
          size="small" 
          class="toggle-lang-btn"
          (click)="toggleLanguage(i)">
          <ion-icon 
            slot="start" 
            [name]="message.showingEnglish ? 'globe' : 'language'">
          </ion-icon>
          <span>{{ message.showingEnglish ? 'Show ' + message.translatedToLanguage : 'View English' }}</span>
        </ion-button>
      </div>
      
      <ion-badge *ngIf="message.wasTranslated && !message.showingEnglish" class="lang-badge" color="light">
        {{ message.translatedToLanguage }}
      </ion-badge>
    </div>
  </div>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <!-- Translation Info Bar -->
    <div *ngIf="translatedLanguage" class="translation-bar">
      <ion-icon name="language-outline"></ion-icon>
      <span>Translated to <b>{{ translatedLanguage }}</b></span>
      <ion-button fill="clear" size="small" (click)="clearTranslation()">
        <ion-icon slot="icon-only" name="close-circle"></ion-icon>
      </ion-button>
    </div>

    <!-- Compact Input Row -->
    <div class="input-container">
      <ion-item lines="none" class="input-item">
        <ion-input
          placeholder="Type your message..."
          [(ngModel)]="typedMessage"
          (keyup.enter)="sendMessage()"
          [disabled]="isTranslating"
        ></ion-input>
        
        <!-- Inline buttons inside input -->
        <div class="inline-buttons" slot="end">
          <!-- Translate Button -->
          <ion-button 
            fill="clear" 
            size="small"
            (click)="translateMessage()" 
            [disabled]="!typedMessage || isTranslating"
            class="translate-btn">
            <ion-spinner *ngIf="isTranslating" name="dots"></ion-spinner>
            <ion-icon *ngIf="!isTranslating" slot="icon-only" name="language"></ion-icon>
          </ion-button>

          <!-- Send Button -->
          <ion-button 
            fill="solid"
            color="primary" 
            size="small"
            (click)="sendMessage()" 
            [disabled]="!typedMessage || isTranslating"
            class="send-btn">
            <ion-icon slot="icon-only" name="send"></ion-icon>
          </ion-button>
        </div>
      </ion-item>
    </div>
  </ion-toolbar>
</ion-footer>